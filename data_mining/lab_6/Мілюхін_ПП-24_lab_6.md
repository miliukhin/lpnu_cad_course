---
pdf-engine: xelatex
header-includes:
- \input{$UNI/.templates/settings/preamble.tex}
- \input{$UNI/.templates/settings/minted_settings.tex}
- \newcommand\Type{\Lab}
- \Work{datamining}
- \renewcommand\Variant{5}
- \newcommand\Date{16.\the\month.\the\year}
- \newcommand\Number{6}
- \newcommand\Topic{Асоціативний аналіз. Методи побудови асоціативних правил.}
---

\input{$UNI/.templates/parts/header.tex}
Метою лабораторної роботи є ознайомлення студентів з методами пошуку асоціативних
правил за допомогою алгоритмів Apriori та FPGrowth в середовищах Weka та Excel.
Студенти мають набути навичок роботи з цими алгоритмами, виконавши певні
тренувальні завдання в середовищі Weka, а потім застосувати ці навички для виконання
індивідуальних завдань на власних наборах даних.
У програмі Excel студенти повинні застосувати алгоритм Apriori до свого власного
набору даних про покупки для знаходження двійкових частих наборів.

1. Тема і мета роботи.
2. Завдання до роботи.
3. Результати виконання завдань.
4. Відповіді на контрольні запитання.
5. Висновки, що відображують результати виконання роботи та їх критичний аналіз.

# Завдання

1. Виконайте наступні завдання для власного набору даних у Weka:
	- Запустіть алгоритм пошуку асоціативних правил Apriori.
	- Яке значення для порогу підтримки було використано в побудованій моделі?
	  Яке значення для порогу достовірності було використано?
	- Запишіть 10 найкращих знайдених правил, вкажіть для них значення
	  підтримки та достовірності.
	- Що позначають числа ліворуч і праворуч від стрілки в знайдених
	  асоціативних правилах?
2. Виконайте наступні завдання для власного набору даних у Weka
	- Запустіть алгоритм пошуку асоціативних правил FPGrowth.
	- Порівняйте списки десяти найкращих правил, отриманих двома алгоритмами.
	  Поясніть відмінність в роботі двох алгоритмів.
	- Згенеруйте також правила, у правій частині яких буде знаходитися ваш
	  цільовий атрибут.
3. Виконайте наступні завдання для власного набору даних в Excel
	- Сформуйте власний набір транзакцій покупок, як показано у прикладі 3.
	- Знайдіть двоелементні групи частих наборів.
	- Організуйте ваші обчислення на кількох аркушах (мінімум одниаркуш із
	  вхідними даними і один аркуш для аналізу.)

# Хід виконання роботи

1. Виконайте наступні завдання для власного набору даних у Weka:
	- Запустіть алгоритм пошуку асоціативних правил Apriori.

	\footnotesize

	```
	=== Run information ===

	Scheme:       weka.associations.Apriori -N 10 -T 0 -C 0.9 -D 0.05 -U 1.0 -M 0.1 -S -1.0 -c -1
	Relation:     vote
	Instances:    435
	Attributes:   17
              	handicapped-infants
              	water-project-cost-sharing
              	adoption-of-the-budget-resolution
              	physician-fee-freeze
              	el-salvador-aid
              	religious-groups-in-schools
              	anti-satellite-test-ban
              	aid-to-nicaraguan-contras
              	mx-missile
              	immigration
              	synfuels-corporation-cutback
              	education-spending
              	superfund-right-to-sue
              	crime
              	duty-free-exports
              	export-administration-act-south-africa
              	Class
	=== Associator model (full training set) ===


	Apriori
	=======

	Minimum support: 0.45 (196 instances)
	Minimum metric <confidence>: 0.9
	Number of cycles performed: 11

	Generated sets of large itemsets:

	Size of set of large itemsets L(1): 20

	Size of set of large itemsets L(2): 17

	Size of set of large itemsets L(3): 6

	Size of set of large itemsets L(4): 1
	```

	\normalsize

	- Яке значення для порогу підтримки було використано в побудованій моделі? **0.45**
	  Яке значення для порогу достовірності було використано? **0.9**

	- Запишіть 10 найкращих знайдених правил, вкажіть для них значення
	  підтримки та достовірності.

	\footnotesize

	```
	Best rules found:

	1. adoption-of-the-budget-resolution=y physician-fee-freeze=n 219 ==>
	   Class=democrat 219    <conf:(1)> lift:(1.63) lev:(0.19) [84]
	   conv:(84.58)
	2. adoption-of-the-budget-resolution=y physician-fee-freeze=n
	   aid-to-nicaraguan-contras=y 198 ==> Class=democrat 198    <conf:(1)>
	   lift:(1.63) lev:(0.18) [76] conv:(76.47)
	3. physician-fee-freeze=n aid-to-nicaraguan-contras=y 211 ==>
	   Class=democrat 210    <conf:(1)> lift:(1.62) lev:(0.19) [80]
	   conv:(40.74)
	4. physician-fee-freeze=n education-spending=n 202 ==> Class=democrat 201
	   <conf:(1)> lift:(1.62) lev:(0.18) [77] conv:(39.01)
	5. physician-fee-freeze=n 247 ==> Class=democrat 245    <conf:(0.99)>
	   lift:(1.62) lev:(0.21) [93] conv:(31.8)
	6. el-salvador-aid=n Class=democrat 200 ==> aid-to-nicaraguan-contras=y 197
	   <conf:(0.98)> lift:(1.77) lev:(0.2) [85] conv:(22.18)
	7. el-salvador-aid=n 208 ==> aid-to-nicaraguan-contras=y 204
	   <conf:(0.98)> lift:(1.76) lev:(0.2) [88] conv:(18.46)
	8. adoption-of-the-budget-resolution=y aid-to-nicaraguan-contras=y
	   Class=democrat 203 ==> physician-fee-freeze=n 198    <conf:(0.98)>
	   lift:(1.72) lev:(0.19) [82] conv:(14.62)
	9. el-salvador-aid=n aid-to-nicaraguan-contras=y 204 ==> Class=democrat 197
	   <conf:(0.97)> lift:(1.57) lev:(0.17) [71] conv:(9.85)
	10. aid-to-nicaraguan-contras=y Class=democrat 218 ==>
		physician-fee-freeze=n 210    <conf:(0.96)> lift:(1.7) lev:(0.2) [86]
		conv:(10.47)
	```

	\normalsize

	- Що позначають числа ліворуч і праворуч від стрілки в знайдених
	  асоціативних правилах?

	Ліворуч від стрілки --- кількість об'єктів із зазначеними атрибутами. Числа праворуч від стрілки:
	* безіменне означає кількість із об'єктів ліворуч, яка відповідає знайденій новій закономірності;
	* conf --- достовірність асоціативного правила;
	* lift --- це міра того, наскільки правило покращує прогнозування результату, порівняно з прогнозуванням без правила;
	* lev --- це міра того, наскільки правило впливає на результат;
	* conv - це міра того, наскільки часто правило веде до результату.

2. Виконайте наступні завдання для власного набору даних у Weka
	- Запустіть алгоритм пошуку асоціативних правил FPGrowth.

	\footnotesize

	```
	=== Run information ===

	Scheme:       weka.associations.FPGrowth -P 2 -I -1 -N 10 -T 0 -C 0.9 -D 0.05 -U 1.0 -M 0.1
	Relation:     vote
	Instances:    435
	Attributes:   17
              	handicapped-infants
              	water-project-cost-sharing
              	adoption-of-the-budget-resolution
              	physician-fee-freeze
              	el-salvador-aid
              	religious-groups-in-schools
              	anti-satellite-test-ban
              	aid-to-nicaraguan-contras
              	mx-missile
              	immigration
              	synfuels-corporation-cutback
              	education-spending
              	superfund-right-to-sue
              	crime
              	duty-free-exports
              	export-administration-act-south-africa
              	Class
	=== Associator model (full training set) ===

	FPGrowth found 41 rules (displaying top 10)

	1. [el-salvador-aid=y, Class=republican]: 157 ==> [physician-fee-freeze=y]: 156
	   <conf:(0.99)> lift:(2.44) lev:(0.21) conv:(46.56)
	2. [crime=y, Class=republican]: 158 ==> [physician-fee-freeze=y]: 155
	   <conf:(0.98)> lift:(2.41) lev:(0.21) conv:(23.43)
	3. [religious-groups-in-schools=y, physician-fee-freeze=y]: 160 ==> [el-salvador-aid=y]: 156
	   <conf:(0.97)> lift:(2) lev:(0.18) conv:(16.4)
	4. [Class=republican]: 168 ==> [physician-fee-freeze=y]: 163
	   <conf:(0.97)> lift:(2.38) lev:(0.22) conv:(16.61)
	5. [adoption-of-the-budget-resolution=y, anti-satellite-test-ban=y,
	   mx-missile=y]: 161 ==> [aid-to-nicaraguan-contras=y]: 155
	   <conf:(0.96)> lift:(1.73) lev:(0.15) conv:(10.2)
	6. [physician-fee-freeze=y, Class=republican]: 163 ==> [el-salvador-aid=y]: 156
	   <conf:(0.96)> lift:(1.96) lev:(0.18) conv:(10.45)
	7. [religious-groups-in-schools=y, el-salvador-aid=y, superfund-right-to-sue=y]: 160 ==> [crime=y]: 153
	   <conf:(0.96)> lift:(1.68) lev:(0.14) conv:(8.6)
	8. [el-salvador-aid=y, superfund-right-to-sue=y]: 170 ==> [crime=y]: 162
	   <conf:(0.95)> lift:(1.67) lev:(0.15) conv:(8.12)
	9. [crime=y, physician-fee-freeze=y]: 168 ==> [el-salvador-aid=y]: 160
	   <conf:(0.95)> lift:(1.95) lev:(0.18) conv:(9.57)
	10. [el-salvador-aid=y, physician-fee-freeze=y]: 168 ==> [crime=y]: 160
		<conf:(0.95)> lift:(1.67) lev:(0.15) conv:(8.02)
	```

	\normalsize

	- Порівняйте списки десяти найкращих правил, отриманих двома алгоритмами.
	  Поясніть відмінність в роботі двох алгоритмів.

	\footnotesize

	```
	1. [el-salvador-aid=y, Class=republican]: 157 ==> [physician-fee-freeze=y]: 156
	2. [crime=y, Class=republican]: 158 ==> [physician-fee-freeze=y]: 155
	3. [religious-groups-in-schools=y, physician-fee-freeze=y]: 160 ==> [el-salvador-aid=y]: 156
	4. [Class=republican]: 168 ==> [physician-fee-freeze=y]: 163
	5. [adoption-of-the-budget-resolution=y, anti-satellite-test-ban=y, mx-missile=y]: 161 ==> [aid-to-nicaraguan-contras=y]: 155
	6. [physician-fee-freeze=y, Class=republican]: 163 ==> [el-salvador-aid=y]: 156
	7. [religious-groups-in-schools=y, el-salvador-aid=y, superfund-right-to-sue=y]: 160 ==> [crime=y]: 153
	8. [el-salvador-aid=y, superfund-right-to-sue=y]: 170 ==> [crime=y]: 162
	9. [crime=y, physician-fee-freeze=y]: 168 ==> [el-salvador-aid=y]: 160
	10. [el-salvador-aid=y, physician-fee-freeze=y]: 168 ==> [crime=y]: 160
	```

	\normalsize

	Найкращі правила FPGrowth не повторюють список Apriori, але так і повинно
	бути. Закономірності краще прослідковуються, наприклад, що з виводу
	FPGrowth, що з результатів Apriori легко бачити, що
	`adoption-of-the-budget-resolution=y` та `aid-to-nicaraguan-contras=y`
	часто трапляються разом, а якщо ще й із `physician-fee-freeze=n`, то можна сказати, що,
	скоріш за все, `Class=democrat`.

	Ясна річ, різність вибору найкращих правил зумовлена відмінностями алгоритмів:

	Apriori використовує підхід генерування та тестування – генерує набори кандидатів і
	тестує чи вони часті.
	FP-Growth дозволяє знаходити набори частих елементів без створення набору
	кандидатів, але через це, як бачимо, не досягає такої впевненості, як Apriori, хоча працює значно швидше.

	\footnotesize

	```
	1. adoption-of-the-budget-resolution=y physician-fee-freeze=n 219 ==> Class=democrat 219
	2. adoption-of-the-budget-resolution=y physician-fee-freeze=n aid-to-nicaraguan-contras=y 198 ==> Class=democrat 198
	3. physician-fee-freeze=n aid-to-nicaraguan-contras=y 211 ==> Class=democrat 210
	4. physician-fee-freeze=n education-spending=n 202 ==> Class=democrat 201
	5. physician-fee-freeze=n 247 ==> Class=democrat 245
	6. el-salvador-aid=n Class=democrat 200 ==> aid-to-nicaraguan-contras=y 197
	7. el-salvador-aid=n 208 ==> aid-to-nicaraguan-contras=y 204
	8. adoption-of-the-budget-resolution=y aid-to-nicaraguan-contras=y Class=democrat 203 ==> physician-fee-freeze=n 198
	9. el-salvador-aid=n aid-to-nicaraguan-contras=y 204 ==> Class=democrat 197
	10. aid-to-nicaraguan-contras=y Class=democrat 218 ==> physician-fee-freeze=n 210
	```

	\normalsize

	- Згенеруйте також правила, у правій частині яких буде знаходитися ваш
	  цільовий атрибут.

	Команда:
	`Scheme:       weka.associations.FPGrowth -P 2 -I -1 -N 10 -T 0 -C 0.9 -D 0.05 -U 1.0 -M 0.1 -rules Class`

	\footnotesize

	```
	Showing only rules that contain: Class

	1. [el-salvador-aid=y, Class=republican]: 157 ==> [physician-fee-freeze=y]:
	   156   <conf:(0.99)> lift:(2.44) lev:(0.21) conv:(46.56)
	2. [crime=y, Class=republican]: 158 ==> [physician-fee-freeze=y]: 155
	   <conf:(0.98)> lift:(2.41) lev:(0.21) conv:(23.43)
	3. [Class=republican]: 168 ==> [physician-fee-freeze=y]: 163
	   <conf:(0.97)> lift:(2.38) lev:(0.22) conv:(16.61)
 	4. [physician-fee-freeze=y, Class=republican]: 163 ==> [el-salvador-aid=y]: 156
	   <conf:(0.96)> lift:(1.96) lev:(0.18) conv:(10.45)
 	5. [physician-fee-freeze=y, Class=republican]: 163 ==> [crime=y]: 155
	   <conf:(0.95)> lift:(1.67) lev:(0.14) conv:(7.79)
 	6. [Class=republican]: 168 ==> [crime=y]: 158
	   <conf:(0.94)> lift:(1.65) lev:(0.14) conv:(6.57)
 	7. [Class=republican]: 168 ==> [el-salvador-aid=y]: 157
	   <conf:(0.93)> lift:(1.92) lev:(0.17) conv:(7.18)
 	8. [el-salvador-aid=y, physician-fee-freeze=y]: 168 ==> [Class=republican]: 156
	   <conf:(0.93)> lift:(2.4) lev:(0.21) conv:(7.93)
 	9. [Class=republican]: 168 ==> [el-salvador-aid=y, physician-fee-freeze=y]: 156
	   <conf:(0.93)> lift:(2.4) lev:(0.21) conv:(7.93)
	10. [crime=y, physician-fee-freeze=y]: 168 ==> [Class=republican]: 155
	   <conf:(0.92)> lift:(2.39) lev:(0.21) conv:(7.37)
	```

	\normalsize

3. Виконайте наступні завдання для власного набору даних в Excel
	- Сформуйте власний набір транзакцій покупок, як показано у прикладі 3.
	- Знайдіть двоелементні групи частих наборів.
	- Організуйте ваші обчислення на кількох аркушах (мінімум одниаркуш із
	  вхідними даними і один аркуш для аналізу.)

	Далі я використовую R замість Excel із міркувань, наведених у попередніх роботах.

	```r
	> receipts <- read.csv("l6.csv")
	```

	Скористаюсь пакунком `arulesViz`:

	```r
	> library(arulesViz)
	```

	Можем починати роботу

	```r
	> trans <- transactions(receipts)
	> summary(trans)
	transactions as itemMatrix in sparse format with
 	22 rows (elements/itemsets/transactions) and
 	9 columns (items) and a density of 0.3333333

	most frequent items:
      	Receipt=[6,10] ItemOnReceipt=[8,11]      Quantity=[8,13]
                  	11                    9                    8
 	ItemOnReceipt=[4,8)       Quantity=[2,5)              (Other)
                   	8                    7                   23

	element (itemset/transaction) length distribution:
	sizes
 	3
	22

   	Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
      	3       3       3       3       3       3

	includes extended item information - examples:
          	labels variables levels
	1  Receipt=[1,3)   Receipt  [1,3)
	2  Receipt=[3,6)   Receipt  [3,6)
	3 Receipt=[6,10]   Receipt [6,10]

	includes extended transaction information - examples:
  	transactionID
	1             1
	2             2
	3             3
	> rules = apriori(trans)
	> inspect(rules)
    	lhs                      rhs                   support   confidence
	[1] {Receipt=[1,3)}       => {ItemOnReceipt=[4,8)} 0.1818182 0.8
	[2] {ItemOnReceipt=[1,4)} => {Receipt=[6,10]}      0.1818182 0.8
    	coverage  lift count
	[1] 0.2272727 2.2  4
	[2] 0.2272727 1.6  4
	```

	Напишу скрипт для зручного перевикористання та демонстрації залежності результатів від параметрів алгоритму:

	\inputminted{r}{script.r}

	\inputminted{r}{output}

	![Виявлені правила з параметрами confidence 0.8 та support 0.1 (rules)](plot_1.pdf){width=12cm}

	![Виявлені правила з параметрами confidence 0.5 та support 0.005 (rules2)](plot_2.pdf){width=12cm}

	![rules2 у формі графа](plot_3.pdf){width=12cm}

	На правила нижче варто було би звернути увагу, в них висока впевненість

	```r
   		  lhs                       rhs                       support confidence   coverage     lift count
	[2]  {Receipt=[1,3)}        => {ItemOnReceipt=[4,8)}  0.18181818  0.8000000 0.22727273 2.200000     4
	[4]  {ItemOnReceipt=[1,4)}  => {Receipt=[6,10]}       0.18181818  0.8000000 0.22727273 1.600000     4
	```

	У цих теж, але значення support дуже низьке --- вони трапляються рідко, та все ж можуть бути корисними:

	```r
	[13] {Receipt=[1,3),
      	ItemOnReceipt=[8,11]} => {Quantity=[2,5)}       0.04545455  1.0000000 0.04545455 3.142857     1
	[15] {Receipt=[1,3),
      	Quantity=[5,8)}       => {ItemOnReceipt=[4,8)}  0.04545455  1.0000000 0.04545455 2.750000     1
	[17] {Receipt=[1,3),
      	Quantity=[8,13]}      => {ItemOnReceipt=[4,8)}  0.09090909  1.0000000 0.09090909 2.750000     2
	[18] {Quantity=[8,13],
      	ItemOnReceipt=[4,8)}  => {Receipt=[1,3)}        0.09090909  1.0000000 0.09090909 4.400000     2
	[19] {Receipt=[3,6),
      	ItemOnReceipt=[1,4)}  => {Quantity=[2,5)}       0.04545455  1.0000000 0.04545455 3.142857     1
	```

# Висновок

В ході виконання даної лабораторної роботи я  ознайомився з методами пошуку асоціативних
правил за допомогою алгоритмів Apriori та FPGrowth в середовищах Weka й R. Набув
навичок роботи з цими алгоритмами, виконавши тренувальні завдання у
Weka та далі проаналізував свої дані.

Під час аналізу файлу `vote.arff` виявив такі закономірності:

* `adoption-of-the-budget-resolution=y` та `aid-to-nicaraguan-contras=y` часто
  трапляються разом, а якщо ще й із `physician-fee-freeze=n`, то можна сказати,
  що, скоріш за все, `Class=democrat`.
* Якщо демократ голосував за підтримку Сальвадору, то великий шанс того, що проголосував за допомогу Контрас
* часто республіканці, які голосували за заморозку гонорарів лікарів також голосуали за допомогу Сальвадору

Саморобний файл трансакцій я не бачу сенсу аналізувати через абсолютну абстрактність даних,
але можу сказати, що під час його дослідження краще зрозумів алгоритм і навчився будувати гарні візуалізації в R.

# Відповіді на контрольні запитання

1. **Що таке асоціативні правила і в яких випадках вони використовуються?**
   Асоціативні правила - це правила, які встановлюють зв'язок між різними
   елементами в наборі даних. Вони використовуються для виявлення цікавих
   зв'язків або закономірностей між елементами даних.

2. **У чому полягає задача пошуку асоціативних правил? Наведіть практичний приклад?**
   В кожного аналізу --- своя задача. Наприклад, у магазині можна знайти правило, яке
   говорить, що якщо покупець купує хліб, то ймовірно, він також купить масло.
   Тоді можна розмістити їх поблизу, щоб збільшити шанс покупки обох товарів.

3. **Що таке частий набір?**
	Частий набір - це набір елементів, які зустрічаються разом у наборі даних з
	певною мінімальною частотою.

4. **Що таке сильне асоціативне правило?**
	Сильне асоціативне правило - це таке правило, яке має високий рівень
	підтримки та достовірності.

5. **З яких двох кроків складається пошук асоціативних правил?**
	1. знаходження частих наборів
	2. генерація правил з цих наборів.

6. **У чому полягає принцип Apriori?**
	Принцип Apriori полягає у тому, щоб спочатку знаходити всі часті набори
	елементів, а потім генерувати асоціативні правила з цих наборів.

7. **Як формуються правила зі знайдених частих наборів?**
	Правила формуються зі знайдених частих наборів шляхом встановлення зв'язку
   	між їх елементами та визначенням показників підтримки, достовірності та
   	підйому.

8. **Що таке алгоритм Apriori? Опишіть його основні принципи роботи.**

	1. Знайти частий набір $L_{k-1}$
	2. Крок об’єднання: $C_k$ генерується об’єднанням $L_{k-1}$ із собою
	   (декартів добуток $L_k \times L_{k-1}$)
	3. Крок скорочення (апріорна властивість): будь-який набір елементів
	   розміру (k − 1), який не є частим, не може бути підмножиною частого
	   набору елементів розміру k, тому його слід видалити
	4. Отримано частий набір $L_k$.

9. **Що таке алгоритм FPGrowth? В чому його переваги порівняно з алгоритмом Apriori?**
	Алгоритм FPGrowth - це алгоритм для пошуку асоціативних правил, який
	базується на структурі дерева FP-дерева. Його перевага --- швидкість.

10. **Як використовувати алгоритм Apriori в середовищі Weka? Продемонструйте кроки.**
	Для використання алгоритму Apriori в середовищі Weka спочатку потрібно
	завантажити набір даних, вибрати алгоритм Apriori, встановити параметри і
	запустити аналіз.

11. **Як використовувати алгоритм FPGrowth в середовищі Weka? Продемонструйте кроки.**
	Для використання алгоритму FPGrowth в середовищі Weka також потрібно
	завантажити набір даних, вибрати алгоритм FPGrowth, встановити параметри і
	запустити аналіз.

12. **Як використовувати алгоритм Apriori в Excel? Продемонструйте кроки.**
	Для використання алгоритму Apriori в Excel спочатку потрібно підготувати
	дані у відповідному форматі, після чого використати вбудовані функції Excel
	для пошуку асоціативних правил.

13. **Що таке спорідненість, підтримка, достовірність та підйом в контексті асоціативних правил?**
	У контексті асоціативних правил спорідненість вказує на силу зв'язку між
	елементами, підтримка вказує на частоту зустрічання правила в наборі даних,
	достовірність вказує на його точність, а підйом вказує на ступінь, до якої
	правило вище середнього рівня зв'язку.

14. **Які результати ви отримали при виконанні тренувальних задач в Weka?**

	У датасеті для погоди дещо відмінні правила від описаних у методичних вказівках, а загалом подібні.
